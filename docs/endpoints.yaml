openapi: 3.0.0
info:
    title: Corporate API
    version: 1.0.0
    description: API for managing corporate data, including scraping, data uploads, analytics, and reporting.
servers:
    - url: /api/corporate
components:
    schemas:
        Error:
            type: object
            properties:
                success:
                    type: boolean
                    example: false
                error:
                    type: string
        UploadResponse:
            type: object
            properties:
                message:
                    type: string
                    example: Uploaded 10 records successfully
        ScrapeRequest:
            type: object
            required: [industry, state, website]
            properties:
                industry:
                    type: string
                    example: Technology
                state:
                    type: string
                    example: California
                website:
                    type: string
                    enum:
                        [
                            naukri,
                            hirist,
                            intern,
                            foundit,
                            glassdoor,
                            shine,
                            timesjob,
                        ]
                    example: naukri
        ScrapedData:
            type: object
            properties:
                job_title:
                    type: string
                company:
                    type: string
                location:
                    type: string
                address:
                    type: string
                phone:
                    type: string
                website:
                    type: string
                gst_number:
                    type: string
        ScrapeResponse:
            type: object
            properties:
                message:
                    type: string
                    example: Scraping completed and 5 records saved.
                data:
                    type: array
                    items:
                        $ref: '#/components/schemas/ScrapedData'
        CleanDuplicatesResponse:
            type: object
            properties:
                message:
                    type: string
                    example: Removed 3 duplicate records successfully
        DataStatsResponse:
            type: object
            properties:
                total:
                    type: integer
                    example: 100
                missing:
                    type: object
                    properties:
                        company_name:
                            type: integer
                            example: 5
                        location:
                            type: integer
                            example: 10
                        job_title:
                            type: integer
                            example: 15
                        address:
                            type: integer
                            example: 20
                        phone_number:
                            type: integer
                            example: 25
                        website_link:
                            type: integer
                            example: 30
                duplicates:
                    type: integer
                    example: 8
        PreviousScrape:
            type: object
            properties:
                job_title:
                    type: string
                company_name:
                    type: string
                location:
                    type: string
        SearchCompaniesResponse:
            type: object
            properties:
                data:
                    type: array
                    items:
                        $ref: '#/components/schemas/ScrapedDataFull'
                total:
                    type: integer
                    example: 50
                totalPages:
                    type: integer
                    example: 5
                currentPage:
                    type: integer
                    example: 1
                limit:
                    type: integer
                    example: 10
        ScrapedDataFull:
            type: object
            properties:
                id:
                    type: integer
                company_name:
                    type: string
                location:
                    type: string
                address:
                    type: string
                phone_number:
                    type: string
                website_link:
                    type: string
                job_title:
                    type: string
                gst_number:
                    type: string
                contact_person_name:
                    type: string
                mobile:
                    type: string
                email:
                    type: string
                state:
                    type: string
                country:
                    type: string
                pincode:
                    type: string
                bd_name:
                    type: string
                industry:
                    type: string
                sub_industry:
                    type: string
                updated:
                    type: string
                    enum: [yes, no]
                communication_status:
                    type: string
                notes:
                    type: string
                meeting_date:
                    type: string
                    format: date
                lead_status:
                    type: string
                updated_at:
                    type: string
                    format: date-time
        SearchMarketingDataResponse:
            type: object
            properties:
                data:
                    type: array
                    items:
                        $ref: '#/components/schemas/ScrapedDataFull'
                total:
                    type: integer
                    example: 50
                totalPages:
                    type: integer
                    example: 5
                currentPage:
                    type: integer
                    example: 1
                limit:
                    type: integer
                    example: 10
        SaveFormRequest:
            type: object
            required: [id]
            properties:
                id:
                    type: integer
                company_name:
                    type: string
                contact_person_name:
                    type: string
                mobile:
                    type: string
                email:
                    type: string
                location:
                    type: string
                state:
                    type: string
                country:
                    type: string
                pincode:
                    type: string
                gst_number:
                    type: string
                bd_name:
                    type: string
                phone_number:
                    type: string
                industry:
                    type: string
                sub_industry:
                    type: string
                website_link:
                    type: string
                updated:
                    type: string
                    enum: [yes, no]
                communication_status:
                    type: string
                notes:
                    type: string
                meeting_date:
                    type: string
                    format: date
                lead_status:
                    type: string
                address:
                    type: string
        SaveFormResponse:
            type: object
            properties:
                message:
                    type: string
                    example: Form data updated successfully!
        DashboardResponse:
            type: object
            properties:
                total:
                    type: object
                    properties:
                        count:
                            type: integer
                reviewed:
                    type: object
                    properties:
                        count:
                            type: integer
                pending:
                    type: object
                    properties:
                        count:
                            type: integer
                marketing:
                    type: object
                    properties:
                        count:
                            type: integer
                growth:
                    type: object
                    properties:
                        rate:
                            type: number
                avgReview:
                    type: object
                    properties:
                        avg_review_time:
                            type: number
                completion:
                    type: object
                    properties:
                        completion_rate:
                            type: integer
                members:
                    type: object
                    properties:
                        count:
                            type: integer
        UpcomingMeeting:
            type: object
            properties:
                company_name:
                    type: string
                meeting_date:
                    type: string
                    format: date
        AnalyticsResponse:
            type: object
            properties:
                sectors:
                    type: array
                    items:
                        type: object
                        properties:
                            sectors:
                                type: string
                            count:
                                type: integer
                status:
                    type: array
                    items:
                        type: object
                        properties:
                            status:
                                type: string
                            count:
                                type: integer
        YearlyTrend:
            type: object
            properties:
                year:
                    type: integer
                Closed:
                    type: integer
                InProgress:
                    type: integer
                Dropped:
                    type: integer
                New:
                    type: integer
        CompanyYearTrend:
            type: object
            properties:
                year:
                    type: integer
                company_name:
                    type: object
                    additionalProperties:
                        type: integer
        LatestCommunication:
            type: object
            properties:
                bd_name:
                    type: string
                company_name:
                    type: string
                date:
                    type: string
                    format: date
                communication_status:
                    type: string
        ReportSummaryResponse:
            type: object
            properties:
                hrContacts:
                    type: integer
                campaigns:
                    type: integer
                recordsEdited:
                    type: integer
        BdComparisonResponse:
            type: object
            properties:
                chartData:
                    type: array
                    items:
                        type: object
                        properties:
                            bd_name:
                                type: string
                            total_work:
                                type: integer
                            interested:
                                type: integer
                            not_interested:
                                type: integer
                            pending_call:
                                type: integer
                            follow_up_needed:
                                type: integer
                allBdNames:
                    type: array
                    items:
                        type: string
        LeadStatusDistribution:
            type: object
            properties:
                chartData:
                    type: array
                    items:
                        type: object
                        properties:
                            lead_status:
                                type: string
                            count:
                                type: integer
        CommunicationStatusOverview:
            type: object
            properties:
                chartData:
                    type: array
                    items:
                        type: object
                        properties:
                            communication_status:
                                type: string
                            count:
                                type: integer
        LocationWiseLeadCount:
            type: object
            properties:
                chartData:
                    type: array
                    items:
                        type: object
                        properties:
                            location:
                                type: string
                            count:
                                type: integer
        StateWiseBdActivities:
            type: object
            properties:
                chartData:
                    type: array
                    items:
                        type: object
                        properties:
                            state:
                                type: string
                            count:
                                type: integer
paths:
    /upload:
        post:
            summary: Upload an Excel file
            description: Uploads an Excel file and inserts its data into the database.
            requestBody:
                required: true
                content:
                    multipart/form-data:
                        schema:
                            type: object
                            properties:
                                file:
                                    type: string
                                    format: binary
            responses:
                '200':
                    description: File uploaded successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/UploadResponse'
                '400':
                    description: No file uploaded or empty file
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '500':
                    description: Server error
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /scrape:
        post:
            summary: Scrape data from a website
            description: Initiates a scraping process for the specified industry, state, and website.
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/ScrapeRequest'
            responses:
                '200':
                    description: Scraping completed
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ScrapeResponse'
                '400':
                    description: Missing required fields or unsupported website
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '500':
                    description: Scraping failed or no data scraped
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /clean-duplicates:
        delete:
            summary: Remove duplicate records
            description: Deletes duplicate records based on company name and location, keeping the first occurrence.
            responses:
                '200':
                    description: Duplicates removed successfully
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CleanDuplicatesResponse'
                '500':
                    description: Failed to remove duplicates
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /data-stats:
        get:
            summary: Get data statistics
            description: Retrieves statistics about total records, missing data, and duplicates.
            responses:
                '200':
                    description: Statistics retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/DataStatsResponse'
                '500':
                    description: Failed to retrieve statistics
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /previous-scrapes:
        get:
            summary: Get previous scrapes
            description: Retrieves the 10 most recent scraped records.
            responses:
                '200':
                    description: Previous scrapes retrieved
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/PreviousScrape'
                '500':
                    description: Failed to fetch previous scrapes
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /search-companies:
        get:
            summary: Search companies
            description: Searches companies with pagination and optional filters for name, city, and updated status.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Company name to filter by
                - in: query
                  name: city
                  schema:
                      type: string
                  description: City to filter by
                - in: query
                  name: updated
                  schema:
                      type: string
                      enum: [yes, no]
                  description: Filter by updated status
                - in: query
                  name: page
                  schema:
                      type: integer
                      default: 1
                  description: Page number
                - in: query
                  name: limit
                  schema:
                      type: integer
                      default: 10
                  description: Number of records per page
            responses:
                '200':
                    description: Search results
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/SearchCompaniesResponse'
                '500':
                    description: Search failed
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /search-marketing-data:
        get:
            summary: Search marketing data
            description: Searches marketing data with pagination and optional filters for name, city, communication status, and lead status.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Company name to filter by
                - in: query
                  name: city
                  schema:
                      type: string
                  description: City to filter by
                - in: query
                  name: communication_status
                  schema:
                      type: string
                  description: Communication status to filter by
                - in: query
                  name: lead_status
                  schema:
                      type: string
                  description: Lead status to filter by
                - in: query
                  name: page
                  schema:
                      type: integer
                      default: 1
                  description: Page number
                - in: query
                  name: limit
                  schema:
                      type: integer
                      default: 10
                  description: Number of records per page
            responses:
                '200':
                    description: Search results
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/SearchMarketingDataResponse'
                '500':
                    description: Search failed
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /save-form:
        post:
            summary: Save form data
            description: Updates a record in the database with the provided form data.
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/SaveFormRequest'
            responses:
                '200':
                    description: Form data updated
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/SaveFormResponse'
                '400':
                    description: Missing company ID
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '404':
                    description: No matching record found
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
                '500':
                    description: Failed to update form data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /delete/{id}:
        delete:
            summary: Delete a record
            description: Deletes a record by ID.
            parameters:
                - in: path
                  name: id
                  schema:
                      type: integer
                  required: true
                  description: Record ID
            responses:
                '200':
                    description: Record deleted
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    message:
                                        type: string
                                        example: Record deleted successfully
                '500':
                    description: Failed to delete record
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /dashboard:
        get:
            summary: Get dashboard data
            description: Retrieves aggregated data for the dashboard, including counts and metrics.
            responses:
                '200':
                    description: Dashboard data retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/DashboardResponse'
                '500':
                    description: Failed to fetch dashboard data
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /upcoming-meetings:
        get:
            summary: Get upcoming meetings
            description: Retrieves meetings scheduled within the next 3 days.
            responses:
                '200':
                    description: Upcoming meetings retrieved
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/UpcomingMeeting'
                '500':
                    description: Failed to fetch meetings
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /analytics:
        get:
            summary: Get analytics data
            description: Retrieves analytics data for sectors and communication status.
            responses:
                '200':
                    description: Analytics data retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/AnalyticsResponse'
                '500':
                    description: Failed to fetch analytics
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /trends/yearly:
        get:
            summary: Get yearly trends
            description: Retrieves yearly trends for lead statuses.
            responses:
                '200':
                    description: Yearly trends retrieved
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/YearlyTrend'
                '500':
                    description: Failed to fetch yearly trends
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /trends/company-year:
        get:
            summary: Get company-year trends
            description: Retrieves trends for top companies by year.
            responses:
                '200':
                    description: Company-year trends retrieved
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/CompanyYearTrend'
                '500':
                    description: Failed to fetch company trends
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /latest-communication:
        get:
            summary: Get latest communication
            description: Retrieves the 3 most recent communications.
            responses:
                '200':
                    description: Latest communications retrieved
                    content:
                        application/json:
                            schema:
                                type: array
                                items:
                                    $ref: '#/components/schemas/LatestCommunication'
                '500':
                    description: Failed to fetch communications
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /report-summary:
        get:
            summary: Get report summary
            description: Retrieves a summary of HR contacts, campaigns, and edited records.
            responses:
                '200':
                    description: Report summary retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ReportSummaryResponse'
                '500':
                    description: Failed to fetch report summary
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /bd-comparison:
        get:
            summary: Get BD comparison
            description: Retrieves comparison data for business development activities, optionally filtered by BD name.
            parameters:
                - in: query
                  name: bdName
                  schema:
                      type: string
                  description: BD name to filter by
            responses:
                '200':
                    description: BD comparison retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/BdComparisonResponse'
                '500':
                    description: Failed to fetch BD comparison
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /lead-status-distribution:
        get:
            summary: Get lead status distribution
            description: Retrieves the distribution of lead statuses with optional filters.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Industry to filter by
                - in: query
                  name: location
                  schema:
                      type: string
                  description: Location to filter by
                - in: query
                  name: communication_status
                  schema:
                      type: string
                  description: Communication status to filter by
                - in: query
                  name: lead_status
                  schema:
                      type: string
                  description: Lead status to filter by
                - in: query
                  name: bd_name
                  schema:
                      type: string
                  description: BD name to filter by
                - in: query
                  name: state
                  schema:
                      type: string
                  description: State to filter by
            responses:
                '200':
                    description: Lead status distribution retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/LeadStatusDistribution'
                '500':
                    description: Failed to fetch lead status distribution
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /communication-status-overview:
        get:
            summary: Get communication status overview
            description: Retrieves the overview of communication statuses with optional filters.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Industry to filter by
                - in: query
                  name: location
                  schema:
                      type: string
                  description: Location to filter by
                - in: query
                  name: communication_status
                  schema:
                      type: string
                  description: Communication status to filter by
                - in: query
                  name: lead_status
                  schema:
                      type: string
                  description: Lead status to filter by
                - in: query
                  name: bd_name
                  schema:
                      type: string
                  description: BD name to filter by
                - in: query
                  name: state
                  schema:
                      type: string
                  description: State to filter by
            responses:
                '200':
                    description: Communication status overview retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CommunicationStatusOverview'
                '500':
                    description: Failed to fetch communication status overview
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /location-wise-lead-count:
        get:
            summary: Get location-wise lead count
            description: Retrieves the top 5 locations by lead count with optional filters.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Industry to filter by
                - in: query
                  name: location
                  schema:
                      type: string
                  description: Location to filter by
                - in: query
                  name: communication_status
                  schema:
                      type: string
                  description: Communication status to filter by
                - in: query
                  name: lead_status
                  schema:
                      type: string
                  description: Lead status to filter by
                - in: query
                  name: bd_name
                  schema:
                      type: string
                  description: BD name to filter by
                - in: query
                  name: state
                  schema:
                      type: string
                  description: State to filter by
            responses:
                '200':
                    description: Location-wise lead count retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/LocationWiseLeadCount'
                '500':
                    description: Failed to fetch location-wise lead count
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
    /state-wise-bd-activities:
        get:
            summary: Get state-wise BD activities
            description: Retrieves the top 5 states by BD activity count with optional filters.
            parameters:
                - in: query
                  name: name
                  schema:
                      type: string
                  description: Industry to filter by
                - in: query
                  name: location
                  schema:
                      type: string
                  description: Location to filter by
                - in: query
                  name: communication_status
                  schema:
                      type: string
                  description: Communication status to filter by
                - in: query
                  name: lead_status
                  schema:
                      type: string
                  description: Lead status to filter by
                - in: query
                  name: bd_name
                  schema:
                      type: string
                  description: BD name to filter by
                - in: query
                  name: state
                  schema:
                      type: string
                  description: State to filter by
            responses:
                '200':
                    description: State-wise BD activities retrieved
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/StateWiseBdActivities'
                '500':
                    description: Failed to fetch state-wise BD activities
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Error'
